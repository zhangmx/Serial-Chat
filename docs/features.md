# Serial Chat 功能文档

## 功能概述

Serial Chat 是一个创新的串口通信工具，将传统的串口通信体验转变为类似社交软件的聊天界面。

## 核心功能

### 1. 串口用户管理

#### 1.1 串口发现
- 自动检测系统中可用的串口
- 支持手动刷新串口列表
- 显示串口详细信息（端口名、描述等）

#### 1.2 串口连接
- 配置串口参数：
  - 波特率：1200 ~ 921600
  - 数据位：5, 6, 7, 8
  - 停止位：1, 1.5, 2
  - 校验位：无、偶校验、奇校验、标记、空格
  - 流控制：无、硬件(RTS/CTS)、软件(XON/XOFF)
- 一键连接/断开
- 自动重连（可选）

#### 1.3 串口备注
- 为串口设置自定义备注名称
- 备注显示在好友列表中
- 便于识别不同设备

### 2. 好友列表

#### 2.1 列表显示
- 分组显示：在线、离线、群组
- 显示串口名称和备注
- 状态指示器（绿色-在线，灰色-离线，红色-错误）
- 显示最后活动时间

#### 2.2 搜索功能
- 按端口名搜索
- 按备注名搜索
- 实时过滤结果

#### 2.3 历史保留
- 离线串口不会从列表删除
- 保留配置和备注信息
- 持久化存储

### 3. 聊天界面

#### 3.1 消息显示
- 聊天气泡样式
- 发送消息：绿色气泡，右对齐
- 接收消息：白色气泡，左对齐
- 显示端口名称和时间戳

#### 3.2 格式切换
- 文本模式：显示 UTF-8 文本
- 十六进制模式：显示 HEX 格式
- 可随时切换显示格式

#### 3.3 消息发送
- 输入框支持多行文本
- 十六进制发送模式
- 发送快捷键支持

#### 3.4 右键菜单
- 复制消息内容
- 复制为十六进制
- 复制为文本
- 切换显示格式

### 4. 聊天组（群聊）

#### 4.1 创建群组
- 自定义群组名称
- 添加群组描述
- 选择群组成员（至少2个）

#### 4.2 消息转发
- 可启用/禁用消息转发
- 一个串口收到的消息自动转发给其他成员
- 实现多串口互通

#### 4.3 群组消息
- 统一显示所有成员的消息
- 区分不同来源
- 独立的消息历史

### 5. 数据持久化

#### 5.1 自动保存
- 好友列表自动保存
- 串口配置持久化
- 聊天组信息保存

#### 5.2 消息历史
- 保存聊天记录
- 程序重启后可恢复
- 支持清除历史

#### 5.3 导出功能
- 导出消息历史
- JSON 格式

## 用户界面

### 主窗口布局

```
+------------------------------------------+
|  菜单栏                                   |
+------------------------------------------+
|          |                               |
|          |     聊天区域                   |
|  好友    |  +-------------------------+  |
|  列表    |  |  消息气泡              |  |
|          |  |  ...                    |  |
|          |  +-------------------------+  |
|          |  |  输入区域              |  |
|          |  +-------------------------+  |
|          |                               |
+------------------------------------------+
|  状态栏                                   |
+------------------------------------------+
```

### 菜单结构

```
文件(F)
├── 刷新串口 (F5)
├── ──────────
├── 导出历史...
├── ──────────
└── 退出 (Ctrl+Q)

串口(P)
├── 添加串口... (Ctrl+N)
├── ──────────
└── 断开所有

视图(V)
└── 清除所有历史

帮助(H)
└── 关于
```

## 快捷键

| 快捷键 | 功能 |
|--------|------|
| F5 | 刷新串口列表 |
| Ctrl+N | 添加新串口 |
| Ctrl+Q | 退出程序 |
| Enter | 发送消息 |
| Ctrl+Enter | 消息换行 |

## 状态指示

### 串口状态

| 状态 | 颜色 | 说明 |
|------|------|------|
| 在线 | 绿色 | 串口已连接，可正常通信 |
| 离线 | 灰色 | 串口未连接 |
| 错误 | 红色 | 串口发生错误 |

### 消息方向

| 方向 | 气泡颜色 | 对齐方式 |
|------|----------|----------|
| 发送 | 绿色 | 右对齐 |
| 接收 | 白色 | 左对齐 |

## 使用场景

### 场景1：单串口调试

1. 点击"添加串口"
2. 选择目标串口，配置参数
3. 点击确定添加到好友列表
4. 点击好友列表中的串口开始聊天
5. 发送调试命令，查看返回数据

### 场景2：串口数据透传

1. 创建聊天组
2. 添加两个或多个串口为成员
3. 启用消息转发
4. 一个串口收到的数据会自动转发给其他成员

### 场景3：多设备监控

1. 添加多个串口到好友列表
2. 为每个串口设置备注（如：温度传感器、GPS模块）
3. 切换不同串口查看数据
4. 使用搜索功能快速定位

## 注意事项

1. **串口独占**：串口一次只能被一个程序打开
2. **编码问题**：文本模式默认使用 UTF-8 编码
3. **数据完整性**：串口数据可能分包接收
4. **备份数据**：重要数据建议定期导出备份
